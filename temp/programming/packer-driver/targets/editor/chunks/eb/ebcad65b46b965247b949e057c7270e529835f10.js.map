{"version":3,"sources":["file:///E:/Cocos/Project/ROYALTEENPATTI/assets/scripts/manages/GameMgr.ts"],"names":["GameMgr","director","native","sys","Singleton","Appic","AudioMgr","ELoginResult","ELoginType","Until","EveMgr","loginInfo","init","user","loginData","DAM","resMg","GetInstance","initAudioMgr","silentSignInGoogle","isNative","os","OS","ANDROID","reflection","callStaticMethod","logInGoogle","Promise","resolve","reject","GuideHandel","body","type","Guest","token","generateRandomString","id_token","name","generateRandomName","id","generateRandomPlayerId","score","loginSucess","data","console","log","JSON","stringify","event","emit","Success","getUserInfo","wariteVerifyIdToken","userData","parse","localStorage","getItem","setItem","androidShare","logOutGoogle","backLogin","preloadScene","Google","removeItem","is_guest","stop","loadScene","exitApp","getItemOfArr","key","arr","item"],"mappings":"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","sourcesContent":["import { JsonAsset, SpriteFrame, director, native, sys } from 'cc';\r\nimport { Singleton } from '../bases/Singleton';\r\nimport Appic from '../tools/Appic';\r\nimport { ILoginData, ILoginInfo, IPlayerInfo } from '../tools/interface';\r\nimport { AudioMgr } from './AudioMgr';\r\nimport { ELoginResult, ELoginType } from '../tools/enumes';\r\nimport { Until } from '../tools/Until';\r\nimport { EveMgr } from './EveMgr';\r\n\r\nexport default class GameMgr extends Singleton<GameMgr> {\r\n    /**玩家登录时信息  */\r\n    public loginInfo: ILoginInfo = {};\r\n\r\n    public init() {\r\n        this.loginInfo = {};\r\n        this.loginInfo.user = {};\r\n        this.loginInfo.user.loginData = {};\r\n        Appic.DAM.init();\r\n        Appic.resMg.init();\r\n        AudioMgr.GetInstance(AudioMgr).initAudioMgr('audio');\r\n    }\r\n    ///谷歌\r\n    /**静默登录 */\r\n    public silentSignInGoogle(): void {\r\n        if (sys.isNative) {\r\n            if (sys.os == sys.OS.ANDROID) {\r\n                native.reflection.callStaticMethod('com/cocos/game/AppActivity', 'silentSignIn', '()V');\r\n            }\r\n            // else if (cc.sys.os == cc.sys.OS_IOS) {\r\n            //     ret = jsb.reflection.callStaticMethod(Native.ApiIOS, 'loginGoogle:', this._callBackPrefix + cbKey);\r\n            // }\r\n        }\r\n    }\r\n    /** 意图登录 */\r\n    public logInGoogle() {\r\n        return new Promise<void>((resolve, reject) => {\r\n            if (sys.isNative) {\r\n                if (sys.os == sys.OS.ANDROID) {\r\n                    native.reflection.callStaticMethod('com/cocos/game/AppActivity', 'logIn', '()V');\r\n                }\r\n                // else if (cc.sys.os == cc.sys.OS_IOS) {\r\n                //     ret = jsb.reflection.callStaticMethod(Native.ApiIOS, 'loginGoogle:', this._callBackPrefix + cbKey);\r\n                // }\r\n            }\r\n        });\r\n    }\r\n    /**游客登录 */\r\n    public GuideHandel(): void {\r\n        var body: ILoginInfo = {};\r\n        body.user = {};\r\n        body.user.loginData = {};\r\n        body.type = ELoginType.Guest;\r\n        // if (!this.deviceInfo.serial_number) return;\r\n        body.token = Until.generateRandomString(8);\r\n        body.user.loginData.id_token = Until.generateRandomString(50);\r\n        body.user.name = Until.generateRandomName();\r\n        body.user.id = Until.generateRandomPlayerId();\r\n        body.user.score = 1000;\r\n        // body.device = this.deviceInfo;\r\n        // var body = { option: loginType.test, phone: this.accountNumber };\r\n        // let _strIdToken: string = this.idToken;\r\n        this.loginSucess(body);\r\n    }\r\n    /**登录成功 开启socket检测  */\r\n    public loginSucess(data: ILoginInfo) {\r\n        if (!data || !data.user) return;\r\n        console.log('登录成功' + JSON.stringify(data));\r\n        this.loginInfo.token = data.token;\r\n        this.loginInfo.user = data.user;\r\n        EveMgr.event.emit(ELoginResult.Success);\r\n    }\r\n    public getUserInfo() {\r\n        return new Promise<void>((resolve, reject) => {\r\n            /**存入idtoken */\r\n\r\n            this.wariteVerifyIdToken(this.loginInfo);\r\n            resolve();\r\n        });\r\n    }\r\n    public wariteVerifyIdToken(data: ILoginInfo) {\r\n        /**存入idtoken */\r\n        if (!data) return;\r\n\r\n        let userData: ILoginInfo = JSON.parse(sys.localStorage.getItem('userData'));\r\n\r\n        userData = data;\r\n\r\n        sys.localStorage.setItem('userData', JSON.stringify(userData));\r\n        console.log('userData:' + userData);\r\n    }\r\n\r\n    /**Android 系统分享 */\r\n    public androidShare(): void {\r\n        if (sys.isNative) {\r\n            if (sys.os == sys.OS.ANDROID) {\r\n                // App.MsgTipMg.show(languageManage.getString('tips_txt6'));\r\n                native.reflection.callStaticMethod('com/cocos/game/AppActivity', 'showShareView', '()V');\r\n            }\r\n            // else if (cc.sys.os == cc.sys.OS_IOS) {\r\n            //     ret = jsb.reflection.callStaticMethod(Native.ApiIOS, 'loginGoogle:', this._callBackPrefix + cbKey);\r\n            // }\r\n        }\r\n    }\r\n    //登出Google\r\n    public logOutGoogle() {\r\n        if (sys.isNative) {\r\n            console.log('logOutGoogle!!!!');\r\n            if (sys.os == sys.OS.ANDROID) {\r\n                native.reflection.callStaticMethod('com/cocos/game/AppActivity', 'logOutGoogle', '()V');\r\n            }\r\n            //  else if (cc.sys.os == cc.sys.OS_IOS) {\r\n            //     jsb.reflection.callStaticMethod(Native.ApiIOS, 'logOutGoogle', null);\r\n            // }\r\n        }\r\n    }\r\n    /**退出登录 */\r\n    public backLogin() {\r\n        return new Promise<void>((resolve, reject) => {\r\n            /// 退出登录\r\n            if (this.loginInfo.type == 1) {\r\n                this.logOutGoogle();\r\n            }\r\n\r\n            director.preloadScene('Login', () => {\r\n                // 当我们需要删除时\r\n                if (this.loginInfo.type != ELoginType.Google) {\r\n                    sys.localStorage.removeItem('userData');\r\n                    let data: ILoginInfo = {};\r\n                    data.user.loginData.is_guest = 1;\r\n\r\n                    this.wariteVerifyIdToken(data);\r\n                }\r\n\r\n                // Appic.resMg.destoryRes();\r\n                AudioMgr.GetInstance(AudioMgr).stop();\r\n                director.loadScene('Login');\r\n                console.log('Login scene preloaded');\r\n            });\r\n        });\r\n    }\r\n    public exitApp() {\r\n        if (sys.isNative) {\r\n            console.log('退出应用!!!!');\r\n            if (sys.os == sys.OS.ANDROID) {\r\n                native.reflection.callStaticMethod('com/cocos/game/AppActivity', 'exitApp', '()V');\r\n            }\r\n            //  else if (cc.sys.os == cc.sys.OS_IOS) {\r\n            //     jsb.reflection.callStaticMethod(Native.ApiIOS, 'logOutGoogle', null);\r\n            // }\r\n        }\r\n    }\r\n\r\n    public static getItemOfArr<T>(key: string, arr: T[]): T | null {\r\n        for (const item of arr) {\r\n            if (key == item['name']) {\r\n                return item;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n}\r\n"]}