{"version":3,"sources":["file:///E:/Cocos/Project/ROYALTEENPATTI/assets/scripts/module/LoginScene.ts"],"names":["_decorator","Button","Component","find","ResolutionPolicy","view","director","sys","Appic","AudioMgr","EAudioType","ELoginResult","ELoginType","EveMgr","ccclass","property","LoginScene","btn_google","btn_email","btn_guest","isCanLogin","userData","setFrameFit","designResolution","getDesignResolutionSize","visibleSize","getVisibleSize","width","height","setDesignResolutionSize","FIXED_WIDTH","FIXED_HEIGHT","onLoad","initView","getComponent","initEvent","node","on","onClickHandel","event","Google","googleLoginPost","Success","loginResultHandel","removeEvent","off","onEnable","start","gameMg","init","loadRes","loadData","onDisable","preloadScene","console","log","JSON","parse","localStorage","getItem","active","user","loginData","is_guest","loginInfo","id_token","loginSucess","update","deltaTime","evet","targetName","target","name","_onGoogleLogin","_onGuestLogin","GetInstance","playOneShot","E_btnEff1","changeBtnStatue","logInGoogle","GuideHandel","btnStatue","interactable","scheduleOnce","data","getUserInfo","then","loadScene","onDestroy"],"mappings":"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","sourcesContent":["import { _decorator, Button, Canvas, Component, find, Node, ResolutionPolicy, Size, view, Event, director, sys } from 'cc';\r\nimport { ILoginInfo } from '../tools/interface';\r\nimport Appic from '../tools/Appic';\r\nimport { AudioMgr } from '../manages/AudioMgr';\r\nimport { EAudioType, EEventRult, ELoginResult, ELoginType } from '../tools/enumes';\r\nimport { EveMgr } from '../manages/EveMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('LoginScene')\r\nexport class LoginScene extends Component {\r\n    /**谷歌登录 */\r\n    protected btn_google: Button = null;\r\n    /**邮箱登录 */\r\n    protected btn_email: Button = null;\r\n    /**试玩登录 */\r\n    protected btn_guest: Button = null;\r\n\r\n    private isCanLogin: boolean = false;\r\n\r\n    private userData: ILoginInfo = {};\r\n\r\n    private setFrameFit(): void {\r\n        const designResolution = view.getDesignResolutionSize();\r\n        const visibleSize = view.getVisibleSize(); // 屏幕可见区域\r\n        // 场景适配\r\n        if (visibleSize.width / visibleSize.height < designResolution.width / designResolution.height) {\r\n            view.setDesignResolutionSize(designResolution.width, designResolution.height, ResolutionPolicy.FIXED_WIDTH);\r\n        } else {\r\n            view.setDesignResolutionSize(designResolution.width, designResolution.height, ResolutionPolicy.FIXED_HEIGHT);\r\n        }\r\n    }\r\n    protected onLoad(): void {\r\n        this.setFrameFit();\r\n        this.initView();\r\n    }\r\n    private initView() {\r\n        this.btn_google = find('Canvas/layer_mid/btn_google')?.getComponent(Button);\r\n        this.btn_guest = find('Canvas/layer_mid/btn_guest')?.getComponent(Button);\r\n    }\r\n\r\n    private initEvent() {\r\n        this.btn_google && this.btn_google.node.on('click', this.onClickHandel, this);\r\n        this.btn_guest && this.btn_guest.node.on('click', this.onClickHandel, this);\r\n        EveMgr.event.on(ELoginType.Google, this.googleLoginPost, this);\r\n        EveMgr.event.on(ELoginResult.Success, this.loginResultHandel, this);\r\n    }\r\n    private removeEvent() {\r\n        this.btn_google && this.btn_google.node.off('click', this.onClickHandel, this);\r\n        this.btn_guest && this.btn_guest.node.off('click', this.onClickHandel, this);\r\n        EveMgr.event.off(ELoginType.Google, this.googleLoginPost, this);\r\n        EveMgr.event.off(ELoginResult.Success, this.loginResultHandel, this);\r\n    }\r\n    protected onEnable(): void {\r\n        this.initEvent();\r\n    }\r\n\r\n    protected start() {\r\n        Appic.gameMg.init();\r\n        this.loadRes();\r\n        this.loadData();\r\n    }\r\n    protected onDisable(): void {\r\n        this.removeEvent();\r\n    }\r\n    \r\n    async loadRes() {\r\n        director.preloadScene('Hall', () => {\r\n            console.log('Hall scene preloaded');\r\n            this.isCanLogin = true;\r\n        });\r\n    }\r\n    async loadData() {\r\n        this.isCanLogin = false;\r\n        this.userData = JSON.parse(sys.localStorage.getItem('userData'));\r\n        this.btn_guest.node.active = !(this.userData && this.userData.user.loginData.is_guest && this.userData.user.loginData.is_guest == 1);\r\n        if (this.userData) {\r\n            this.isCanLogin = true;\r\n            Appic.gameMg.loginInfo = this.userData;\r\n\r\n            if (Appic.gameMg.loginInfo.user.loginData.id_token) {\r\n                Appic.gameMg.loginSucess(Appic.gameMg.loginInfo);\r\n            }\r\n        }\r\n    }\r\n    update(deltaTime: number) {}\r\n\r\n    private onClickHandel(evet: Event) {\r\n        let targetName = evet.target.name;\r\n        switch (targetName) {\r\n            case 'btn_google':\r\n                this._onGoogleLogin();\r\n                break;\r\n            case 'btn_guest':\r\n                this._onGuestLogin();\r\n                break;\r\n\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**谷歌登录请求服务器 */\r\n    private _onGoogleLogin(): void {\r\n        AudioMgr.GetInstance(AudioMgr).playOneShot(EAudioType.E_btnEff1);\r\n        this.changeBtnStatue(false);\r\n        // App.SysMg.showWaite();\r\n        Appic.gameMg.logInGoogle();\r\n    }\r\n    /**游客登录 */\r\n    private _onGuestLogin(): void {\r\n        AudioMgr.GetInstance(AudioMgr).playOneShot(EAudioType.E_btnEff1);\r\n        this.changeBtnStatue(false);\r\n        // App.SysMg.showWaite();\r\n        Appic.gameMg.GuideHandel();\r\n    }\r\n\r\n    private changeBtnStatue(btnStatue: boolean) {\r\n        this.btn_google.interactable = btnStatue;\r\n        this.btn_guest.interactable = btnStatue;\r\n        this.scheduleOnce(() => {\r\n            if (!btnStatue) {\r\n                this.btn_google.interactable = !btnStatue;\r\n                this.btn_guest.interactable = !btnStatue;\r\n            }\r\n        }, 1.5);\r\n    }\r\n    /**谷歌登录回调 */\r\n    public googleLoginPost(data: ILoginInfo) {\r\n        Appic.gameMg.loginSucess(data);\r\n    }\r\n\r\n    /*login success**/\r\n    private loginResultHandel() {\r\n        Appic.gameMg.getUserInfo().then(() => {\r\n            this.loadScene();\r\n        });\r\n    }\r\n\r\n    /**跳转场景 */\r\n    private loadScene() {\r\n        // Appic.gameMg.hideWaite();\r\n        // let waitimg: cc.Node = this.node.getChildByName(this.nodeName);\r\n        // if (waitimg) {\r\n        //     App.ResMg.putNode(waitimg);\r\n        // }\r\n        this.isCanLogin = true;\r\n        director.loadScene('Hall');\r\n    }\r\n    protected onDestroy(): void {}\r\n}\r\n"]}