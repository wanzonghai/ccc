{"version":3,"sources":["assets\\script\\playLayer.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport DataManager from \"./DataManager\";\nimport util from \"./util/util\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class NewClass extends cc.Component {\n\n    @property({type: cc.Node, tooltip: \"小图展示\"})\n    miniShowNode: cc.Node = null;\n\n    @property({type: cc.Node, tooltip: \"拼图容器\"})\n    puzzleLayout: cc.Node = null;\n\n    @property({type: cc.Node, tooltip: \"动画展示精灵\"})\n    aniSprite: cc.Node = null;\n\n    @property({type: cc.Node, tooltip: \"触摸事件接收节点\"})\n    touchLayer: cc.Node = null;\n\n    @property({type: [cc.SpriteFrame], tooltip: \"拼图原图纹理\"})\n    MaxSpriteFrameList: cc.SpriteFrame[] = [];\n\n    /** 切好的拼图纹理 */\n    MinSpriteFrameList: Array<Array<Array<cc.SpriteFrame>>> = [];\n\n    /** 行数 */\n    rowNum: number = 4;\n\n    /** 列数 */\n    colNum: number = 4;\n\n    /** 当前使用拼图序号 */\n    curUsePuzzleIndex: number = 1;\n\n    /** 当前使用的拼图纹理数组 */\n    curUsePuzzleSpriteFrame: Array<Array<cc.SpriteFrame>> = [];\n\n    /** 元素间隔 */\n    itemInterval: number = 0;\n\n    /** 当前选取的元素 */\n    curSelectItem: cc.Node = null;\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {}\n\n    start () {\n        let curStage = DataManager.stageRanks[DataManager.curGameStage];\n\n        this.rowNum = this.colNum = curStage;\n        this.aniSprite.parent.setPosition(this.puzzleLayout.position.clone());\n        this.initPuzzleSpriteFrame();\n        this.initPuzzleNode();\n        this.bindingPuzzleMoveEvent();\n        this.testMesh();\n    }\n\n    /**\n     * 初始化拼图纹理\n    */\n    initPuzzleSpriteFrame() {\n        this.MaxSpriteFrameList.forEach((maxSpriteFrame) => {\n            this.MinSpriteFrameList.push(util.gridCutSpriteFrame(maxSpriteFrame, this.rowNum, this.colNum, this.itemInterval))\n        });\n\n        this.curUsePuzzleSpriteFrame = this.MinSpriteFrameList[this.curUsePuzzleIndex];\n    }\n\n    /**\n     * 初始化拼图节点\n    */\n    initPuzzleNode() {\n        let spriteFrameSize: cc.Size = this.getPuzzleSpriteFrameByIndex(0).getRect().size;\n\n        this.puzzleLayout.getComponent(cc.Layout).spacingX = this.itemInterval;\n        this.puzzleLayout.getComponent(cc.Layout).spacingY = this.itemInterval;\n\n        this.aniSprite.getComponent(cc.Sprite).sizeMode = cc.Sprite.SizeMode.CUSTOM;\n        this.aniSprite.setContentSize(util.copyObj(spriteFrameSize));\n\n        for(let i: number = 0; i < this.rowNum * this.colNum; i++) {\n            let puzzleNode = new cc.Node();\n            let puzzleSprite = puzzleNode.addComponent(cc.Sprite);\n\n            puzzleSprite.sizeMode = cc.Sprite.SizeMode.CUSTOM;\n            puzzleNode[\"index\"] = i;\n            puzzleNode.setContentSize(util.copyObj(spriteFrameSize));\n            this.puzzleLayout.addChild(puzzleNode);\n        }\n\n        this.scheduleOnce(() => {\n            this.puzzleLayout.getComponent(cc.Layout).enabled = false;\n        })\n    }\n\n    /**\n     * 绑定拼图拖拽事件\n    */\n    bindingPuzzleMoveEvent() {\n        let endCall = (e: cc.Event.EventTouch) => {\n            if(!this.touchLayer[\"existItme\"]) return;\n            let palceNode = this.checkPlaceAllow(this.aniSprite.convertToWorldSpaceAR(cc.v2(0, 0)).clone());\n\n            this.touchLayer[\"existItme\"] = false;\n\n            if(palceNode) { // 放置成功\n                DataManager.gameLayerScr.node.getComponent(cc.AudioSource).clip = DataManager.gameLayerScr.audioResList[9];\n                DataManager.gameLayerScr.node.getComponent(cc.AudioSource).play();\n                this.curSelectItem.active = true;\n                this.curSelectItem[\"curPuzzleSpriteIndex\"] = palceNode[\"curPuzzleSpriteIndex\"];\n                this.curSelectItem.getComponent(cc.Sprite).spriteFrame = this.getPuzzleSpriteFrameByIndex(palceNode[\"curPuzzleSpriteIndex\"]);\n                palceNode[\"curPuzzleSpriteIndex\"] = this.aniSprite[\"curPuzzleSpriteIndex\"];\n                palceNode.getComponent(cc.Sprite).spriteFrame = this.getPuzzleSpriteFrameByIndex(this.aniSprite[\"curPuzzleSpriteIndex\"]);\n\n                this.aniSprite.active = false;\n                if(this.checkIsWin()) {\n                    DataManager.gameLayerScr.showResult(true);\n                    console.log(\"胜利\");\n                }\n            } else {\n                this.aniSprite.active = false;\n                this.curSelectItem.active = true;\n            }\n            \n        }\n\n        this.touchLayer.on(cc.Node.EventType.TOUCH_START, (e: cc.Event.EventTouch) => {\n            let puzzleNode = this.getPuzzleNodeByWorldPos(e.getLocation());\n\n            if(puzzleNode) { // 当前世界坐标上有元素\n                DataManager.gameLayerScr.node.getComponent(cc.AudioSource).clip = DataManager.gameLayerScr.audioResList[9];\n                DataManager.gameLayerScr.node.getComponent(cc.AudioSource).play();\n                cc.Tween.stopAllByTarget(this.aniSprite);\n                this.aniSprite.scale = 1.1;\n                this.curSelectItem = puzzleNode;\n                this.aniSprite[\"curPuzzleSpriteIndex\"] = puzzleNode[\"curPuzzleSpriteIndex\"];\n                this.touchLayer[\"existItme\"] = true;\n\n                puzzleNode.active = false;\n                this.aniSprite.setPosition(puzzleNode.position.clone());\n                this.aniSprite.active = true;\n                this.aniSprite.getComponent(cc.Sprite).spriteFrame = this.getPuzzleSpriteFrameByIndex(puzzleNode[\"curPuzzleSpriteIndex\"]);\n\n                cc.tween(this.aniSprite)\n                    .to(0.05, {scale: 1.2})\n                    .to(0.05, {scale: 1})\n                    .to(0.05, {scale: 1.1})\n                    .start();\n            }\n        })\n        this.touchLayer.on(cc.Node.EventType.TOUCH_MOVE, (e: cc.Event.EventTouch) => {\n            if(this.touchLayer[\"existItme\"]) {\n                let delay = e.getDelta();\n    \n                this.aniSprite.setPosition(delay.add(cc.v2(this.aniSprite.x, this.aniSprite.y)));\n            }\n        });\n        this.touchLayer.on(cc.Node.EventType.TOUCH_END, endCall);\n        this.touchLayer.on(cc.Node.EventType.TOUCH_CANCEL, endCall);\n    }\n\n    /**\n     * 生成随机放置拼图\n    */\n    createRandomPuzzle() {\n        this.curUsePuzzleIndex = util.getRandom(0, this.MaxSpriteFrameList.length-1);\n        this.initPuzzleSpriteFrame();\n        let indexList = [];\n\n        for(let i: number = 0; i < this.rowNum * this.colNum; i++) {\n            indexList.push(i);\n        }\n\n        indexList = util.getRandomListItme(indexList, indexList.length);\n\n        this.puzzleLayout.children.forEach((puzzleNode, i) => {\n            let puzzleSprite = puzzleNode.getComponent(cc.Sprite);\n            let spriteIndex = indexList[i];\n\n            puzzleNode[\"curPuzzleSpriteIndex\"] = spriteIndex;\n            puzzleSprite.spriteFrame = this.getPuzzleSpriteFrameByIndex(spriteIndex);\n        });\n        this.miniShowNode.getComponent(cc.Sprite).spriteFrame = this.MaxSpriteFrameList[this.curUsePuzzleIndex];\n    }\n\n    /**\n     * 根据index获得当前数组中纹理\n    */\n    getPuzzleSpriteFrameByIndex(index: number) {\n        let col = index % this.colNum;\n        let row = Math.floor(index / this.colNum);\n\n        return this.curUsePuzzleSpriteFrame[row][col];\n    }\n\n    /**\n     * 检测是否放置在item上\n    */\n    checkPlaceAllow(worldPos: cc.Vec2 | cc.Vec3): cc.Node {\n        let placeNode: cc.Node = null;\n\n        this.puzzleLayout.children.forEach((puzzleNode) => {\n            if(placeNode) return;\n            placeNode = util.checkPointExistNode(puzzleNode, worldPos);\n        });\n\n        return placeNode;\n    }\n\n    /**\n     * 获取世界坐标上拼图\n    */\n    getPuzzleNodeByWorldPos(worldPos: cc.Vec2 | cc.Vec3) {\n        let placeNode: cc.Node = null;\n\n        this.puzzleLayout.children.forEach((puzzleNode) => {\n            if(placeNode) return;\n            placeNode = util.checkPointExistNode(puzzleNode, worldPos);\n        });\n\n        return placeNode;\n    }\n\n    /**\n     * 检测胜利\n    */\n    checkIsWin(): boolean {\n        let isWin = true;\n\n        this.puzzleLayout.children.forEach((puzzleNode) => {\n            if(puzzleNode[\"curPuzzleSpriteIndex\"] != puzzleNode[\"index\"]) {\n                isWin = false;\n            }\n        });\n\n        return isWin;\n    }\n\n    /**\n     * 测试mesh\n    */\n    testMesh() {\n        let sp = this.miniShowNode.getComponent(cc.Sprite);\n\n        // @ts-ignore\n        sp.spriteFrame.vertices = {\n            x: [0, 100, 100],\n            y: [0, 0, 100],\n            nu: [0, 1, 1],\n            nv: [0, 0, 1], \n            triangles: [0, 1, 2],\n        }\n        \n        // @ts-ignore\n        sp.setVertsDirty();\n    }\n\n    // update (dt) {}\n}\n"]}